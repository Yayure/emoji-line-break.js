<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>emoji-line-break.js</title>
<meta name="description" content="Split emoji text into multiple lines.">
<meta name="keywords" content="emoji-line-break.js, emoji-line-break">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
<style type="text/css">

    .navbar-brand {
        font-weight: 300;
    } 
    .navbar-brand .h6  {
        font-weight: 300;
    }

    .ui-options .input-group {
        margin-top: 10px;
    }
    .ui-options .input-group:first-child {
        margin-top: 30px;
    }
    .ui-options .input-group-prepend .input-group-text {
        min-width: 85px;
    }
    .ui-options .btn {
        white-space: nowrap;
    }

    .rcanvas {
        height: auto;
        border: 1px solid transparent;
    }

    #textarea {
        margin-top: 30px;
    }
</style>
</head>
<body>
    <header class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
              <a class="navbar-brand" href="https://github.com/Yayure/emoji-line-break.js">emoji-line-break.js<small class="h6">&ensp;v1.0.2</small></a>
              <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                  <li class="nav-item active">
                    <a class="nav-link" href="https://github.com/Yayure/emoji-line-break.js/blob/master/README.md" id="readme">Docs </a>
                  </li>
                </ul>
              </div>
        </div>
    </header>
    <div class="container">
        <div class="row">
            <div class="col-md-8">
                <textarea class="form-control" rows="9" id="textarea" placeholder="input your text in here"></textarea>
            </div>
            <div class="col-md-4 ui-options">
                <div class="input-group input-group-sm">
                    <span class="input-group-prepend">
                        <label class="input-group-text" for="lang">lang</label>
                    </span>
                    <div class="btn-group btn-group-toggle" id="lang" data-toggle="buttons">
                        <label class="btn btn-secondary btn-sm">
                            <input type="radio" name="options" value="zh"> zh
                        </label>
                        <label class="btn btn-secondary btn-sm">
                            <input type="radio" name="options" value="en"> en
                        </label>
                    </div>
                </div>
                <div class="input-group input-group-sm">
                    <span class="input-group-prepend">
                        <label class="input-group-text" for="wordBreak">wordBreak</label>
                    </span>
                    <div class="btn-group btn-group-toggle" id="wordBreak" data-toggle="buttons">
                        <label class="btn btn-secondary btn-sm">
                            <input type="radio" name="options" value="break-all"> break-all
                        </label>
                        <label class="btn btn-secondary btn-sm">
                            <input type="radio" name="options" value="break-word"> break-word
                        </label>
                    </div>
                </div>
                <div class="input-group input-group-sm">
                    <span class="input-group-prepend">
                        <label class="input-group-text" for="fontWeight">fontWeight</label>
                    </span>
                    <div class="btn-group btn-group-toggle" id="fontWeight" data-toggle="buttons">
                        <label class="btn btn-secondary btn-sm">
                            <input type="radio" name="options" value="lighter"> lighter
                        </label>
                        <label class="btn btn-secondary btn-sm">
                            <input type="radio" name="options" value="normal" checked> normal
                        </label>
                        <label class="btn btn-secondary btn-sm">
                            <input type="radio" name="options" value="bold"> bold
                        </label>
                    </div>
                </div>
                <div class="input-group input-group-sm">
                    <span class="input-group-prepend">
                        <label class="input-group-text" for="fontFamily">fontFamily</label>
                    </span>
                    <div class="btn-group btn-group-toggle" id="fontFamily" data-toggle="buttons">
                        <label class="btn btn-secondary btn-sm">
                            <input type="radio" name="options" value="serif"> serif
                        </label>
                        <label class="btn btn-secondary btn-sm">
                            <input type="radio" name="options" value="sans-serif" checked> sans-serif
                        </label>
                        <label class="btn btn-secondary btn-sm">
                            <input type="radio" name="options" value="Arial"> Arial
                        </label>
                        <label class="btn btn-secondary btn-sm">
                            <input type="radio" name="options" value="cursive"> cursive
                        </label>
                    </div>
                </div>
                <div class="input-group input-group-sm">
                    <span class="input-group-prepend">
                        <label class="input-group-text" for="fontSize">fontSize</label>
                    </span>
                    <input type="number" class="form-control" id="fontSize" value="16" placeholder="">
                    <span class="input-group-append">
                        <span class="input-group-text">px</span>
                    </span>
                </div>
                <div class="input-group input-group-sm">
                    <span class="input-group-prepend">
                        <label class="input-group-text" for="width">width</label>
                    </span>
                    <input type="number" class="form-control" id="width" value="500" placeholder="">
                    <span class="input-group-append">
                        <span class="input-group-text">px</span>
                    </span>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="form-control rcanvas">
                    <hr />
                    <canvas width="" height="" id="canvas"></canvas>
                </div>
            </div>
        </div>
    </div>
</body>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

<script type="text/javascript" src="../dist/emoji-line-break.min.js"></script>
<script type="text/javascript">
    "use strict";

    let model = {
        defaultText: {
            zh: `JavaScript ( JS ) 是一种具有函数优先的轻量级，解释型或即时编译型的编程语言。虽然它是作为开发Web 页面的脚本语言而出名的，但是它也被用到了很多非浏览器环境中，例如 Node.js、 Apache CouchDB 和 Adobe Acrobat。JavaScript 是一种基于原型编程、多范式的动态脚本语言，并且支持面向对象、命令式和声明式（如函数式编程）风格。☕☕☕☕☕☕☕☕☕☕☕☕☕☕☕☕☕☕☕☕☕☕☕☕☕`,
            en: `JavaScript (JS) is a lightweight, interpreted, or just-in-time compiled programming language with first-class functions. While it is most well-known as the scripting language for Web pages, many non-browser environments also use it, such as Node.js, Apache CouchDB and Adobe Acrobat. JavaScript is a prototype-based, multi-paradigm, single-threaded, dynamic language, supporting object-oriented, imperative, and declarative (e.g. functional programming) styles.☕☕☕☕☕☕☕☕☕☕☕☕☕☕☕☕☕☕☕☕☕☕☕☕☕`
        },
        readme: {
            zh: 'https://github.com/Yayure/emoji-line-break.js/blob/master/README_ZH.md',
            en: 'https://github.com/Yayure/emoji-line-break.js/blob/master/README.md'
        }
    }

    let view = {
        allInput: $('input,textarea'),
        textarea: $('#textarea'),
        lang: $('#lang'),
        wordBreak: $('#wordBreak'),
        fontWeight: $('#fontWeight'),
        fontFamily: $('#fontFamily'),
        fontSize: $('#fontSize'),
        width: $('#width'),
        readmeLink: $('#readme'),
        canvas: $('#canvas')
    }

    let controller = {
        init: function() {
            this.setDefault();

            this.bindAllInput();

            this.renderToCanvas();
        },
        setDefault: function() {
            let now = new Date();
            let jetLag =now.getHours() - now.getUTCHours();
            let lang = (jetLag === 8 || jetLag === -16) ? 'zh' : 'en';

            if (lang === 'zh') {
                view.textarea.val(model.defaultText.zh);
                view.lang.find('input[value=zh]').attr('checked', true);
                view.wordBreak.find('input[value=break-all]').attr('checked', true);
                view.readmeLink.attr('href', model.readme.zh);
            } else {
                view.textarea.val(model.defaultText.en);
                view.lang.find('input[value=en]').attr('checked', true);
                view.wordBreak.find('input[value=break-word]').attr('checked', true);
                view.readmeLink.attr('href', model.readme.en);
            }
        },
        renderToCanvas: function(text) {
            text = text || view.textarea.val();

            let options = {
                lang: view.lang.find('input[checked]').val(),
                wordBreak: view.wordBreak.find('input[checked]').val(),
                fontWeight: view.fontWeight.find('input[checked]').val(),
                fontFamily: view.fontFamily.find('input[checked]').val(),
                fontSize: +view.fontSize.val(),
                width: +view.width.val()
            }

            let ctx = view.canvas[0].getContext("2d");
            let lines = emojiLineBreak(text, options);
            let baseH = 24 * Math.abs((view.fontSize.val() / 16));

            view.canvas.attr('width', options.width);
            view.canvas.attr('height', baseH * (lines.length + 0.5));

            ctx.restore();
            ctx.font = `${options.fontWeight} ${options.fontSize}px ${options.fontFamily}`;

            lines.forEach((item, index) => {
                ctx.fillText(item, 0, (index + 1) * baseH);
            })

            console.log('options:', options);
            console.log('reslut:', lines);
            console.log('********************')
        },
        bindAllInput: function() {
            var that = this;

            view.allInput.each(function() {
                if ($(this).attr('type') === 'radio') {
                    $(this).on('change',function(e) {
                        $(this).parents('.btn-group').find('input').removeAttr('checked');
                        $(this).attr('checked', true);
                        
                        that.renderToCanvas();
                    });
                } else {
                    $(this).on('input',function() {
                        that.renderToCanvas();
                    });
                }
            })
        }
    }

    controller.init();
</script>
</html>